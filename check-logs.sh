#!/bin/bash

# æ—¥å¿—æŸ¥çœ‹è„šæœ¬ - ç”¨äºŽè¯Šæ–­æ•™æ¡ˆä¿å­˜é—®é¢˜

echo "=========================================="
echo "ðŸ“Š InspireEd æ—¥å¿—æŸ¥çœ‹å·¥å…·"
echo "=========================================="
echo ""

# æ£€æŸ¥æ—¥å¿—ç›®å½•
LOG_DIR="./logs"
if [ ! -d "$LOG_DIR" ]; then
    echo "âŒ æ—¥å¿—ç›®å½•ä¸å­˜åœ¨: $LOG_DIR"
    exit 1
fi

# æ˜¾ç¤ºèœå•
echo "è¯·é€‰æ‹©æŸ¥çœ‹çš„æ—¥å¿—ç±»åž‹ï¼š"
echo ""
echo "1. å®žæ—¶æŸ¥çœ‹åŽç«¯æ—¥å¿—ï¼ˆtail -fï¼‰"
echo "2. æŸ¥çœ‹æœ€è¿‘ 100 è¡ŒåŽç«¯æ—¥å¿—"
echo "3. æŸ¥æ‰¾æ•™æ¡ˆç›¸å…³æ—¥å¿—ï¼ˆéœ€è¦è¾“å…¥æ•™æ¡ˆIDï¼‰"
echo "4. æŸ¥æ‰¾ Cell è¿‡æ»¤/éªŒè¯æ—¥å¿—"
echo "5. æŸ¥æ‰¾é”™è¯¯æ—¥å¿—"
echo "6. æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶åˆ—è¡¨"
echo "7. æ¸…ç©ºæ‰€æœ‰æ—¥å¿—ï¼ˆæ…Žç”¨ï¼ï¼‰"
echo ""
read -p "è¯·è¾“å…¥é€‰é¡¹ï¼ˆ1-7ï¼‰: " choice

case $choice in
    1)
        echo ""
        echo "ðŸ“¡ å®žæ—¶æŸ¥çœ‹åŽç«¯æ—¥å¿—ï¼ˆæŒ‰ Ctrl+C é€€å‡ºï¼‰..."
        echo "=========================================="
        tail -f "$LOG_DIR/backend.log"
        ;;
    2)
        echo ""
        echo "ðŸ“„ æœ€è¿‘ 100 è¡ŒåŽç«¯æ—¥å¿—ï¼š"
        echo "=========================================="
        tail -100 "$LOG_DIR/backend.log"
        ;;
    3)
        echo ""
        read -p "è¯·è¾“å…¥æ•™æ¡ˆID: " lesson_id
        echo ""
        echo "ðŸ” æŸ¥æ‰¾æ•™æ¡ˆ $lesson_id ç›¸å…³æ—¥å¿—ï¼š"
        echo "=========================================="
        tail -200 "$LOG_DIR/backend.log" | grep "æ•™æ¡ˆ $lesson_id"
        ;;
    4)
        echo ""
        echo "ðŸ” æŸ¥æ‰¾ Cell è¿‡æ»¤/éªŒè¯æ—¥å¿—ï¼š"
        echo "=========================================="
        tail -200 "$LOG_DIR/backend.log" | grep -E "(è¿‡æ»¤|Cell\[|éªŒè¯|æ— æ•ˆ|invalid)" --color=always
        ;;
    5)
        echo ""
        echo "âŒ æŸ¥æ‰¾é”™è¯¯æ—¥å¿—ï¼š"
        echo "=========================================="
        tail -200 "$LOG_DIR/backend.log" | grep -E "(ERROR|Error|é”™è¯¯|âŒ)" --color=always
        ;;
    6)
        echo ""
        echo "ðŸ“ æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ï¼š"
        echo "=========================================="
        ls -lh "$LOG_DIR/"
        ;;
    7)
        echo ""
        read -p "âš ï¸  ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰åŽ†å²è®°å½•ï¼(yes/no): " confirm
        if [ "$confirm" = "yes" ]; then
            > "$LOG_DIR/backend.log"
            > "$LOG_DIR/frontend.log"
            echo "âœ… æ—¥å¿—å·²æ¸…ç©º"
        else
            echo "âŒ å·²å–æ¶ˆ"
        fi
        ;;
    *)
        echo ""
        echo "âŒ æ— æ•ˆé€‰é¡¹"
        exit 1
        ;;
esac

echo ""
echo "=========================================="
echo ""
echo "ðŸ’¡ æç¤ºï¼š"
echo "  - åŽç«¯æ—¥å¿—: tail -f logs/backend.log"
echo "  - å‰ç«¯æ—¥å¿—: æµè§ˆå™¨æŽ§åˆ¶å°ï¼ˆF12 æˆ– Cmd+Option+Iï¼‰"
echo "  - ç½‘ç»œè¯·æ±‚: æµè§ˆå™¨å¼€å‘è€…å·¥å…· > Network æ ‡ç­¾"
echo ""

