# ✅ 频繁出现的401错误已修复

## 问题原因

你遇到的 **401 Unauthorized** 错误是由于前端代码中**token存储key不一致**导致的：

- 登录时token保存为 `localStorage.setItem('access_token', token)`
- 但收藏、评论、学习路径服务尝试读取 `localStorage.getItem('token')`  ❌
- 结果读取到null，导致请求没有认证信息，服务器返回401错误

这个bug会在**教师端和学生端都出现**，影响以下功能：
- ❌ 收藏功能
- ❌ 评论功能  
- ❌ 学习路径功能

## 已修复的文件

1. ✅ `frontend/src/services/favorite.ts` - 收藏服务
2. ✅ `frontend/src/services/review.ts` - 评论服务
3. ✅ `frontend/src/services/learningPath.ts` - 学习路径服务

所有服务现在都使用统一的token key: `'access_token'`

## 如何测试修复

### 重要：需要清除浏览器缓存

```javascript
// 方法1: 在浏览器控制台运行
localStorage.clear()

// 方法2: 手动清除
// 1. 打开浏览器开发者工具 (F12)
// 2. 进入 Application/应用程序 标签
// 3. 左侧选择 Local Storage
// 4. 右键点击你的网站域名 -> Clear
```

### 测试步骤

1. **清除localStorage** (必须!)
2. **重新登录** 学生账号或教师账号
3. **访问Dashboard**
4. **检查控制台** - 应该没有401错误了
5. **测试功能**:
   - 收藏课程
   - 查看收藏列表
   - 发表评论
   - 查看学习路径

## 关于422错误 (推荐课程)

```
GET /api/v1/lessons/recommended 422 (Unprocessable Entity)
```

这个错误可能是：
1. **认证问题** - 修复token key后应该解决
2. **数据库问题** - 可能没有发布状态的课程

修复token后重新测试，如果422仍然出现，请告诉我完整的错误信息。

## 为什么这个问题经常出现？

因为代码库中有些服务使用 `'token'`，有些使用 `'access_token'`。当用户：
1. 登录 -> token存储为 'access_token'
2. 访问某些功能 -> 尝试读取 'token' -> 读不到 -> 401错误
3. 刷新页面 -> 同样的问题继续出现

现在统一使用 `'access_token'` 后，这个问题应该不会再出现了。

## 当前状态

```
✅ 代码已修复
✅ Frontend服务运行中
✅ Backend服务运行中
⏳ 需要用户清除localStorage后重新登录测试
```

## 访问地址

- 前端: http://192.168.2.37:5173
- 后端: http://192.168.2.37:8000
- API文档: http://192.168.2.37:8000/docs

## 测试账号

- 学生: `student@inspireed.com` / `student123`
- 教师: `teacher@inspireed.com` / `teacher123`

---

**重要提醒**: 修复后第一次使用时，请务必清除localStorage并重新登录！

