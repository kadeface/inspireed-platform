# 学科教研组功能说明

## 功能概述

学科教研组是一个教师协作平台，允许学科教师创建、加入教研组，并在组内共享教学设计，促进教学资源的交流与优化。

## 核心功能

### 1. 教研组管理

#### 创建教研组
- **权限**: 所有教师
- **功能**: 
  - 指定教研组名称、描述
  - 选择所属学科
  - 设置教研组范围（校级/区域级/全国级）
  - 设置公开/私密状态
  - 上传封面图片

#### 教研组类型
- **校级教研组**: 仅限特定学校的教师参与
- **区域级教研组**: 特定区域（省/市/区）的教师可参与
- **全国级教研组**: 所有教师都可参与

#### 教研组角色
- **组长 (Owner)**: 创建者，拥有最高权限
  - 编辑教研组信息
  - 删除教研组
  - 管理所有成员
  - 管理共享教学设计
- **管理员 (Admin)**: 
  - 编辑教研组信息
  - 添加/移除普通成员
  - 管理共享教学设计
- **普通成员 (Member)**:
  - 查看教研组信息
  - 分享自己的教学设计
  - 查看和下载组内共享的教学设计

### 2. 成员管理

#### 添加成员
- 组长和管理员可以添加新成员
- 指定新成员的角色（管理员/普通成员）

#### 编辑成员
- 修改成员角色（不能修改组长）
- 激活/停用成员

#### 移除成员
- 组长和管理员可以移除普通成员
- 成员可以主动退出教研组
- 不能移除组长

### 3. 教学设计共享

#### 分享教学设计
- **权限**: 教研组成员
- **功能**:
  - 选择自己创建的教学设计
  - 添加分享说明
  - 分享到教研组

#### 查看共享教学设计
- 查看教学设计详情
- 查看分享者信息和分享说明
- 记录查看次数

#### 复制/下载教学设计
- 复制共享的教学设计到自己的账号
- 记录下载次数

#### 移除共享
- 分享者可以取消自己的分享
- 组长和管理员可以移除任何共享

### 4. 统计信息

系统提供以下统计数据：
- 全部教研组数量
- 我的教研组数量
- 总成员数
- 共享教学设计总数
- 我的分享数量

## 技术实现

### 后端实现

#### 数据模型
```python
# SubjectGroup - 教研组
- 基本信息：名称、描述、学科、范围
- 关联：学校、区域、创建者
- 统计：成员数、教案数

# GroupMembership - 成员关系
- 教研组ID、用户ID、角色
- 加入时间、激活状态

# SharedLesson - 共享教学设计
- 教研组ID、教案ID、分享者ID
- 分享说明、统计数据（查看、下载、点赞）
```

#### API接口
```
教研组管理:
POST   /api/v1/subject-groups/              创建教研组
GET    /api/v1/subject-groups/              获取教研组列表
GET    /api/v1/subject-groups/{id}          获取教研组详情
PUT    /api/v1/subject-groups/{id}          更新教研组
DELETE /api/v1/subject-groups/{id}          删除教研组

成员管理:
GET    /api/v1/subject-groups/{id}/members        获取成员列表
POST   /api/v1/subject-groups/{id}/members        添加成员
PUT    /api/v1/subject-groups/{id}/members/{uid}  更新成员
DELETE /api/v1/subject-groups/{id}/members/{uid}  移除成员

教学设计共享:
GET    /api/v1/subject-groups/{id}/lessons           获取共享教学设计列表
POST   /api/v1/subject-groups/{id}/lessons           分享教学设计
PUT    /api/v1/subject-groups/{id}/lessons/{lid}     更新共享
DELETE /api/v1/subject-groups/{id}/lessons/{lid}     取消分享
POST   /api/v1/subject-groups/{id}/lessons/{lid}/view     增加查看次数
POST   /api/v1/subject-groups/{id}/lessons/{lid}/download 增加下载次数

统计信息:
GET    /api/v1/subject-groups/statistics/overview  获取统计信息
```

### 前端实现

#### 页面结构
```
/teacher/subject-groups              教研组列表页
/teacher/subject-groups/{id}         教研组详情页
```

#### 组件结构
```
SubjectGroups.vue                    教研组列表页面
SubjectGroupDetail.vue               教研组详情页面

Components:
├── CreateGroupModal.vue             创建教研组模态框
├── EditGroupModal.vue               编辑教研组模态框
├── GroupMembersList.vue             成员列表组件
├── AddMemberModal.vue               添加成员模态框
├── EditMemberModal.vue              编辑成员模态框
├── SharedLessonsList.vue            共享教学设计列表组件
└── ShareLessonModal.vue             分享教学设计模态框
```

#### 服务和类型
```
services/subjectGroup.ts             教研组API服务
types/subjectGroup.ts                类型定义
```

## 使用流程

### 教师创建教研组
1. 访问 `/teacher/subject-groups`
2. 点击"创建教研组"按钮
3. 填写教研组信息
4. 提交创建

### 教师加入教研组
1. 浏览教研组列表
2. 由组长或管理员邀请加入
3. 或申请加入公开教研组（待开发）

### 教师分享教学设计
1. 进入教研组详情页
2. 切换到"共享教学设计"标签
3. 点击"分享教案"按钮
4. 选择要分享的教学设计
5. 添加分享说明
6. 提交分享

### 教师查看和使用共享教学设计
1. 进入教研组详情页
2. 浏览共享教学设计列表
3. 点击"查看"查看详情
4. 点击"复制"将教学设计复制到自己的账号

## 数据库迁移

执行以下命令应用数据库迁移：

```bash
cd backend
alembic upgrade head
```

迁移脚本位置：`backend/alembic/versions/009_add_subject_groups.py`

## 权限控制

- 所有教师可以创建教研组
- 教研组创建者自动成为组长
- 只有教研组成员可以分享教学设计
- 只能分享自己创建的教学设计
- 组长和管理员可以管理成员和共享内容

## 后续优化方向

1. **申请加入机制**: 教师可以申请加入公开教研组，由管理员审核
2. **教学设计评论**: 成员可以对共享的教学设计进行评论和讨论
3. **教学设计点赞**: 支持点赞功能，标记优质教学设计
4. **活动日志**: 记录教研组内的重要活动
5. **消息通知**: 新成员加入、新教学设计分享时通知组内成员
6. **数据分析**: 提供教研组活跃度、教学设计受欢迎度等数据分析
7. **导出功能**: 批量导出教研组内的教学设计
8. **标签系统**: 为共享的教学设计添加标签，便于分类和搜索

## 注意事项

1. 教研组删除是软删除，数据库中保留记录
2. 成员移除也是软删除，可以重新激活
3. 共享教学设计的原始教案如果被删除，共享记录仍然保留但无法访问
4. 确保数据库中已有学科、学校、区域等基础数据

## 测试建议

1. 创建不同范围的教研组（校级、区域级、全国级）
2. 测试不同角色的权限（组长、管理员、普通成员）
3. 测试教学设计的分享和查看流程
4. 测试成员的添加、编辑、移除功能
5. 验证统计数据的准确性

