# 章节导入功能使用指南

## 概述

章节导入功能允许管理员通过 Excel 或 CSV 文件批量导入课程章节，支持多级章节结构。

## 功能特点

- ✅ 支持 Excel (.xlsx, .xls) 和 CSV (.csv) 格式
- ✅ 支持多级章节结构（通过 parent_code 建立父子关系）
- ✅ 提供标准模板下载
- ✅ 拖拽上传文件
- ✅ 实时导入反馈

## 使用步骤

### 1. 进入课程管理页面

- 以管理员身份登录系统
- 导航至 **管理员** > **课程体系管理**

### 2. 打开导入章节对话框

- 点击页面顶部的 **📥 导入章节** 按钮
- 等待课程列表加载完成

### 3. 下载导入模板

- 点击 **下载导入模板** 按钮
- 系统会下载一个名为 `章节导入模板.xlsx` 的文件
- 模板包含示例数据，展示如何组织章节信息

### 4. 准备导入数据

#### 必需列

| 列名 | 说明 | 示例 |
|------|------|------|
| name | 章节名称 | 第一章：集合与函数 |
| code | 章节编码（唯一） | chapter-1 |
| display_order | 显示顺序 | 1 |

#### 可选列

| 列名 | 说明 | 示例 |
|------|------|------|
| description | 章节描述 | 介绍集合的基本概念和运算 |
| parent_code | 父章节编码 | chapter-1 |
| is_active | 是否启用 | True/False |

#### 建立层级关系

- 使用 `parent_code` 字段建立父子关系
- `parent_code` 应该引用已存在的章节的 `code` 值
- 确保父章节在子章节之前导入（按 display_order 排序）

#### 示例数据

```csv
name,code,description,display_order,parent_code,is_active
第一章：集合与函数,chapter-1,介绍集合的基本概念和运算,1,,True
1.1 集合的概念,section-1-1,学习集合的定义和表示方法,1,chapter-1,True
1.2 集合的运算,section-1-2,掌握集合的交集、并集、补集运算,2,chapter-1,True
第二章：函数,chapter-2,学习函数的概念和性质,2,,True
```

### 5. 选择课程

- 在下拉菜单中选择要导入章节的目标课程
- 如果找不到合适的课程，需要先创建课程

### 6. 上传文件

两种方式：

1. **拖拽上传**
   - 将准备好的文件直接拖拽到上传区域

2. **点击选择**
   - 点击 **点击选择文件** 按钮
   - 在文件选择器中选择文件

### 7. 开始导入

- 确认课程和文件都已选择
- 点击 **开始导入** 按钮
- 等待导入完成

### 8. 查看结果

- 导入成功会显示成功消息和导入的章节数量
- 导入失败会显示错误信息，帮助定位问题

## 常见问题

### Q1: 导入失败，提示"缺少必需的列"

**A:** 确保 Excel/CSV 文件包含所有必需的列：`name`、`code`、`display_order`。列名必须完全匹配（区分大小写）。

### Q2: 导入失败，提示"父章节未找到"

**A:** 检查以下几点：
- 确保 `parent_code` 引用的章节编码存在于文件中
- 确保父章节在子章节之前（display_order 更小）
- 检查父章节的 `code` 值是否与 `parent_code` 完全匹配

### Q3: 如何创建多级章节？

**A:** 示例：

```
章节1 (code: ch1, parent_code: 空)
  ├─ 小节1.1 (code: sec1-1, parent_code: ch1)
  │   └─ 子节1.1.1 (code: subsec1-1-1, parent_code: sec1-1)
  └─ 小节1.2 (code: sec1-2, parent_code: ch1)
```

### Q4: 章节编码（code）有什么要求？

**A:** 
- 在同一课程内必须唯一
- 建议使用有意义的编码，如：chapter-1、section-1-1
- 只能包含字母、数字、连字符(-)和下划线(_)

### Q5: 可以重复导入吗？

**A:** 
- 不能重复导入相同编码的章节
- 如果需要更新，请先删除现有章节或使用编辑功能
- 建议先测试小批量数据，确认无误后再全量导入

## 最佳实践

1. **使用模板**
   - 始终从下载的模板开始
   - 保留示例数据作为参考

2. **分步导入**
   - 先导入顶级章节
   - 验证无误后再导入子章节
   - 或者确保文件中父章节排在子章节前面

3. **命名规范**
   - 使用统一的编码规则
   - 名称清晰明确
   - 描述简明扼要

4. **数据验证**
   - 导入前检查数据完整性
   - 确保没有重复的章节编码
   - 验证父子关系的正确性

5. **备份策略**
   - 保存原始导入文件
   - 记录导入的时间和课程
   - 必要时可以删除后重新导入

## 技术细节

### API 端点

- **批量导入**: `POST /chapters/chapters/batch-import?course_id={id}`
- **下载模板**: `GET /chapters/chapters/export-template`

### 支持的文件格式

- Excel 2007+ (.xlsx)
- Excel 97-2003 (.xls)
- CSV (.csv, UTF-8 编码)

### 文件大小限制

- 建议单次导入不超过 1000 行
- 文件大小不超过 10MB

## 相关功能

- **查看章节**: 点击课程的"章节"按钮可查看已导入的章节
- **编辑章节**: 在章节列表中可以编辑单个章节
- **删除章节**: 可以删除没有资源和子章节的章节

## 未来改进

- [ ] 支持导入时更新现有章节
- [ ] 支持导出现有章节为 Excel
- [ ] 批量编辑章节顺序
- [ ] 章节预览功能
- [ ] 导入进度条

---

**版本**: 1.0  
**最后更新**: 2025-10-18

