# åŸºäºè¯¾ç¨‹æ¨¡æ¿çš„æ•™æ¡ˆè®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€è®¾è®¡ç†å¿µ

### æ ¸å¿ƒæ€æƒ³
æ•™å¸ˆåˆ›å»ºæ•™æ¡ˆæ—¶ï¼Œä¸æ˜¯ä»é›¶å¼€å§‹ï¼Œè€Œæ˜¯åŸºäº**è¯¾ç¨‹æ ‡å‡†æ•™æ¡ˆæ¨¡æ¿**è¿›è¡ŒäºŒæ¬¡ä¿®æ”¹ï¼Œå½¢æˆä¸ªæ€§åŒ–çš„æ•™å­¦å†…å®¹ã€‚

### è®¾è®¡åˆç†æ€§åˆ†æ

#### âœ… ä¼˜åŠ¿
1. **ç¬¦åˆçœŸå®æ•™å­¦åœºæ™¯**
   - æ•™å¸ˆé€šå¸¸åŸºäºæ•™æã€å¤§çº²ã€å‚è€ƒæ•™æ¡ˆè¿›è¡Œå¤‡è¯¾
   - ä¸æ˜¯å®Œå…¨åŸåˆ›ï¼Œè€Œæ˜¯åœ¨æ ‡å‡†åŸºç¡€ä¸Šåšä¸ªæ€§åŒ–è°ƒæ•´

2. **æé«˜æ•™å­¦æ•ˆç‡**
   - é¿å…é‡å¤åˆ›å»ºåŸºç¡€å†…å®¹
   - æ•™å¸ˆä¸“æ³¨äºä¸ªæ€§åŒ–æ”¹è¿›å’Œåˆ›æ–°

3. **ä¿è¯æ•™å­¦è´¨é‡**
   - æ ‡å‡†æ¨¡æ¿ç¡®ä¿çŸ¥è¯†ç‚¹å®Œæ•´æ€§
   - é™ä½æ–°æ•™å¸ˆçš„å¤‡è¯¾é—¨æ§›

4. **ä¿ƒè¿›çŸ¥è¯†å…±äº«**
   - ä¼˜ç§€æ•™æ¡ˆå¯ä»¥æˆä¸ºæ–°çš„æ¨¡æ¿
   - æ•™å¸ˆé—´å¯ä»¥äº’ç›¸å­¦ä¹ å’Œæ”¹è¿›

5. **æ”¯æŒè¿­ä»£ä¼˜åŒ–**
   - æ¨¡æ¿å¯ä»¥æŒç»­æ›´æ–°
   - æ•™å¸ˆå¯ä»¥é€‰æ‹©åŒæ­¥æœ€æ–°ç‰ˆæœ¬

#### ğŸ¯ é€‚ç”¨åœºæ™¯
- æ–°æ•™å¸ˆå¿«é€Ÿä¸Šæ‰‹
- æ ‡å‡†åŒ–è¯¾ç¨‹æ•™å­¦
- æ•™ç ”ç»„åä½œå¤‡è¯¾
- ç²¾å“è¯¾ç¨‹å»ºè®¾

---

## äºŒã€æ•°æ®æ¨¡å‹è®¾è®¡

### 2.1 æ¦‚å¿µæ¨¡å‹

```
è¯¾ç¨‹ä½“ç³»
  â””â”€â”€ è¯¾ç¨‹ï¼ˆCourseï¼‰
       â”œâ”€â”€ ç« èŠ‚ï¼ˆChapterï¼‰
       â”‚    â””â”€â”€ èµ„æºï¼ˆResourceï¼‰
       â”‚         â””â”€â”€ ğŸ“‹ æ ‡å‡†æ•™æ¡ˆæ¨¡æ¿ï¼ˆLessonTemplateï¼‰
       â”‚              â†“ [å¤åˆ¶/å¼•ç”¨]
       â”‚         ğŸ‘¤ æ•™å¸ˆæ•™æ¡ˆï¼ˆTeacherLessonï¼‰
       â”‚              - ä¸ªæ€§åŒ–ä¿®æ”¹
       â”‚              - ä¿ç•™æ¨¡æ¿å¼•ç”¨
       â”‚              - å¯åŒæ­¥æ›´æ–°
```

### 2.2 æ•°æ®åº“æ¨¡å‹

#### LessonTemplate (æ ‡å‡†æ•™æ¡ˆæ¨¡æ¿)
```python
class LessonTemplate(Base):
    """æ ‡å‡†æ•™æ¡ˆæ¨¡æ¿ - è¯¾ç¨‹èµ„æºçš„ä¸€éƒ¨åˆ†"""
    __tablename__ = "lesson_templates"
    
    id: int
    resource_id: int  # å…³è”åˆ° Resource
    title: str  # æ•™æ¡ˆæ ‡é¢˜
    description: str  # æ•™æ¡ˆæè¿°
    content: JSON  # Cell æ•°ç»„
    version: str  # ç‰ˆæœ¬å·ï¼Œå¦‚ "1.0.0"
    difficulty: str  # éš¾åº¦ï¼šbasic/intermediate/advanced
    estimated_duration: int  # é¢„è®¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    tags: List[str]  # æ ‡ç­¾
    
    # å…ƒæ•°æ®
    created_by: int  # åˆ›å»ºè€…ï¼ˆé€šå¸¸æ˜¯ç®¡ç†å‘˜æˆ–ä¸“å®¶ï¼‰
    is_official: bool  # æ˜¯å¦å®˜æ–¹æ¨¡æ¿
    usage_count: int  # è¢«ä½¿ç”¨æ¬¡æ•°
    rating: float  # è¯„åˆ†
    
    # æ—¶é—´æˆ³
    created_at: datetime
    updated_at: datetime
```

#### Lesson (æ•™å¸ˆæ•™æ¡ˆ)
```python
class Lesson(Base):
    """æ•™å¸ˆæ•™æ¡ˆ - æ•™å¸ˆä¸ªäººçš„æ•™å­¦å†…å®¹"""
    __tablename__ = "lessons"
    
    id: int
    course_id: int  # æ‰€å±è¯¾ç¨‹
    teacher_id: int  # æ‰€å±æ•™å¸ˆ
    
    # åŸºæœ¬ä¿¡æ¯
    title: str
    description: str
    content: JSON  # Cell æ•°ç»„
    tags: List[str]
    
    # æ¨¡æ¿å…³è”
    template_id: int | None  # æ¥æºæ¨¡æ¿IDï¼ˆå¯é€‰ï¼‰
    template_version: str | None  # å¤åˆ¶æ—¶çš„æ¨¡æ¿ç‰ˆæœ¬
    is_modified: bool  # æ˜¯å¦å·²ä¿®æ”¹
    modification_summary: str | None  # ä¿®æ”¹æ‘˜è¦
    
    # çŠ¶æ€
    status: str  # draft/published/archived
    visibility: str  # private/shared/public
    
    # ç»Ÿè®¡
    view_count: int
    student_count: int
    
    # æ—¶é—´æˆ³
    created_at: datetime
    updated_at: datetime
    published_at: datetime | None
```

#### LessonModificationLog (ä¿®æ”¹æ—¥å¿—)
```python
class LessonModificationLog(Base):
    """è®°å½•æ•™å¸ˆå¯¹æ¨¡æ¿çš„ä¿®æ”¹"""
    __tablename__ = "lesson_modification_logs"
    
    id: int
    lesson_id: int
    teacher_id: int
    
    # ä¿®æ”¹å†…å®¹
    modification_type: str  # add_cell/remove_cell/edit_cell/reorder
    cell_id: str | None
    changes: JSON  # å…·ä½“å˜æ›´å†…å®¹
    
    created_at: datetime
```

### 2.3 å…³è”å…³ç³»

```
Subject (å­¦ç§‘)
  â””â”€â”€ Grade (å¹´çº§)
       â””â”€â”€ Course (è¯¾ç¨‹)
            â”œâ”€â”€ Chapter (ç« èŠ‚)
            â”‚    â””â”€â”€ Resource (èµ„æº)
            â”‚         â””â”€â”€ LessonTemplate (æ ‡å‡†æ•™æ¡ˆæ¨¡æ¿) â†â”€â”
            â”‚                                              â”‚
            â””â”€â”€ Lesson (æ•™å¸ˆæ•™æ¡ˆ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 - teacher_id                    [å¼•ç”¨å…³ç³»]
                 - template_id
```

---

## ä¸‰ã€ç”¨æˆ·äº¤äº’æµç¨‹è®¾è®¡

### 3.1 æµè§ˆè¯¾ç¨‹åˆ°åˆ›å»ºæ•™æ¡ˆ

#### æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æµè§ˆè¯¾ç¨‹ç»“æ„                                          â”‚
â”‚    å­¦ç§‘ â†’ å¹´çº§ â†’ è¯¾ç¨‹ â†’ ç« èŠ‚ â†’ èµ„æº                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æŸ¥çœ‹èµ„æºè¯¦æƒ…                                          â”‚
â”‚    - æ˜¾ç¤ºèµ„æºè¯´æ˜                                        â”‚
â”‚    - æ˜¾ç¤ºå…³è”çš„æ•™æ¡ˆæ¨¡æ¿åˆ—è¡¨                              â”‚
â”‚    - æ¯ä¸ªæ¨¡æ¿æ˜¾ç¤ºï¼šæ ‡é¢˜ã€æè¿°ã€éš¾åº¦ã€æ—¶é•¿ã€è¯„åˆ†          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. é€‰æ‹©æ•™æ¡ˆæ¨¡æ¿                                          â”‚
â”‚    [é€‰é¡¹A] é¢„è§ˆæ¨¡æ¿å†…å®¹                                  â”‚
â”‚    [é€‰é¡¹B] åŸºäºæ­¤æ¨¡æ¿åˆ›å»ºæˆ‘çš„æ•™æ¡ˆ                        â”‚
â”‚    [é€‰é¡¹C] ä»ç©ºç™½å¼€å§‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åˆ›å»ºæ•™æ¡ˆå¯¹è¯æ¡†                                        â”‚
â”‚    âœ“ å·²é€‰è¯¾ç¨‹ï¼š[æ˜¾ç¤ºè¯¾ç¨‹åç§°]                            â”‚
â”‚    âœ“ å·²é€‰æ¨¡æ¿ï¼š[æ˜¾ç¤ºæ¨¡æ¿åç§°]ï¼ˆå¯ä¿®æ”¹ï¼‰                  â”‚
â”‚    - è¾“å…¥æ•™æ¡ˆæ ‡é¢˜ï¼ˆé»˜è®¤ï¼šæ¨¡æ¿æ ‡é¢˜ï¼‰                      â”‚
â”‚    - è¾“å…¥æ•™æ¡ˆæè¿°                                        â”‚
â”‚    - æ·»åŠ ä¸ªæ€§åŒ–æ ‡ç­¾                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿæˆæ•™å¸ˆæ•™æ¡ˆ                                          â”‚
â”‚    - å¤åˆ¶æ¨¡æ¿çš„æ‰€æœ‰ Cell                                 â”‚
â”‚    - è®°å½•æ¨¡æ¿å¼•ç”¨å…³ç³»                                    â”‚
â”‚    - è·³è½¬åˆ°ç¼–è¾‘å™¨                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ä¸ªæ€§åŒ–ç¼–è¾‘                                            â”‚
â”‚    - ä¿®æ”¹ Cell å†…å®¹                                      â”‚
â”‚    - æ·»åŠ /åˆ é™¤ Cell                                      â”‚
â”‚    - è°ƒæ•´é¡ºåº                                            â”‚
â”‚    - ç³»ç»Ÿè‡ªåŠ¨æ ‡è®°"å·²ä¿®æ”¹"                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ä¿å­˜å’Œå‘å¸ƒ                                            â”‚
â”‚    - è‡ªåŠ¨ä¿å­˜ä¿®æ”¹                                        â”‚
â”‚    - å¯æŸ¥çœ‹ä¸æ¨¡æ¿çš„å·®å¼‚                                  â”‚
â”‚    - å‘å¸ƒç»™å­¦ç”Ÿä½¿ç”¨                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç•Œé¢è®¾è®¡è‰å›¾

#### A. è¯¾ç¨‹ç»“æ„æµè§ˆé¡µï¼ˆå¢å¼ºç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯¾ç¨‹ï¼šé«˜ä¸€æ•°å­¦                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“š ç¬¬ä¸€ç« ï¼šé›†åˆä¸å‡½æ•°                                     â”‚
â”‚   â””â”€ ğŸ“– 1.1 é›†åˆçš„æ¦‚å¿µ                                   â”‚
â”‚        â”œâ”€ ğŸ“„ æ•™æèµ„æº                                    â”‚
â”‚        â”œâ”€ ğŸ¥ è§†é¢‘èµ„æº                                    â”‚
â”‚        â””â”€ ğŸ“‹ æ ‡å‡†æ•™æ¡ˆ (2ä¸ªæ¨¡æ¿)              [æŸ¥çœ‹è¯¦æƒ…] â”‚
â”‚                                                           â”‚
â”‚   â””â”€ ğŸ“– 1.2 é›†åˆçš„è¿ç®—                                   â”‚
â”‚        â””â”€ ğŸ“‹ æ ‡å‡†æ•™æ¡ˆ (3ä¸ªæ¨¡æ¿)              [æŸ¥çœ‹è¯¦æƒ…] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### B. æ•™æ¡ˆæ¨¡æ¿è¯¦æƒ…å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ æ•™æ¡ˆæ¨¡æ¿ï¼šé›†åˆçš„æ¦‚å¿µ                      [Ã—]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  ğŸ“Š åŸºæœ¬ä¿¡æ¯                                             â”‚
â”‚     éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜† åŸºç¡€                                    â”‚
â”‚     æ—¶é•¿ï¼š45 åˆ†é’Ÿ                                        â”‚
â”‚     è¯„åˆ†ï¼šâ­ 4.8 (126 ä½æ•™å¸ˆä½¿ç”¨)                        â”‚
â”‚     ç‰ˆæœ¬ï¼šv1.2.0                                         â”‚
â”‚                                                           â”‚
â”‚  ğŸ“ å†…å®¹æ¦‚è§ˆ                                             â”‚
â”‚     1. æ–‡æœ¬å•å…ƒï¼šè¯¾ç¨‹å¯¼å…¥                                â”‚
â”‚     2. æ–‡æœ¬å•å…ƒï¼šé›†åˆçš„å®šä¹‰                              â”‚
â”‚     3. ä»£ç å•å…ƒï¼šPython é›†åˆæ“ä½œæ¼”ç¤º                     â”‚
â”‚     4. é—®ç­”å•å…ƒï¼šé›†åˆç»ƒä¹ é¢˜ (5é¢˜)                        â”‚
â”‚     5. ä»¿çœŸå•å…ƒï¼šç»´æ©å›¾äº¤äº’                              â”‚
â”‚                                                           â”‚
â”‚  ğŸ’¬ æ•™å¸ˆè¯„ä»·                                             â”‚
â”‚     "å†…å®¹å®Œæ•´ï¼Œä»£ç ç¤ºä¾‹å¾ˆå®ç”¨" - ç‹è€å¸ˆ                  â”‚
â”‚     "å­¦ç”Ÿåé¦ˆå¾ˆå¥½ï¼Œäº’åŠ¨æ€§å¼º" - æè€å¸ˆ                    â”‚
â”‚                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¢„è§ˆæ¨¡æ¿å†…å®¹]  [åŸºäºæ­¤æ¨¡æ¿åˆ›å»ºæˆ‘çš„æ•™æ¡ˆ]  [å–æ¶ˆ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### C. åˆ›å»ºæ•™æ¡ˆå¯¹è¯æ¡†ï¼ˆåŸºäºæ¨¡æ¿ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºæˆ‘çš„æ•™æ¡ˆ                                  [Ã—]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  âœ“ é€‰å®šè¯¾ç¨‹                                              â”‚
â”‚    å­¦ç§‘ï¼šæ•°å­¦  å¹´çº§ï¼šé«˜ä¸€                                â”‚
â”‚    è¯¾ç¨‹ï¼šé«˜ä¸€æ•°å­¦ â†’ ç¬¬ä¸€ç«  â†’ 1.1 é›†åˆçš„æ¦‚å¿µ             â”‚
â”‚                                                           â”‚
â”‚  âœ“ é€‰å®šæ¨¡æ¿                                              â”‚
â”‚    ğŸ“‹ é›†åˆçš„æ¦‚å¿µ (v1.2.0)                    [æ›´æ¢æ¨¡æ¿] â”‚
â”‚    åŒ…å« 5 ä¸ªæ•™å­¦å•å…ƒ                                     â”‚
â”‚                                                           â”‚
â”‚  âœï¸ ä¸ªæ€§åŒ–ä¿¡æ¯                                           â”‚
â”‚    æ•™æ¡ˆæ ‡é¢˜ *                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚ é›†åˆçš„æ¦‚å¿µ - 2025é«˜ä¸€(3)ç­           â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”‚    æ•™æ¡ˆæè¿°                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚ é’ˆå¯¹æœ¬ç­å­¦ç”ŸåŸºç¡€ï¼Œå¢åŠ æ›´å¤šå®ä¾‹       â”‚            â”‚
â”‚    â”‚ å¼ºåŒ–ç¼–ç¨‹å®è·µç¯èŠ‚                     â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”‚    æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚ é›†åˆ, Python, é«˜ä¸€3ç­                â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”‚  â„¹ï¸ æç¤ºï¼šåˆ›å»ºåï¼Œæ‚¨å¯ä»¥è‡ªç”±ä¿®æ”¹æ‰€æœ‰å†…å®¹                â”‚
â”‚                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         [å–æ¶ˆ]  [åˆ›å»ºæ•™æ¡ˆ]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### D. ç¼–è¾‘å™¨ä¸­çš„æ¨¡æ¿å…³è”æç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† | é›†åˆçš„æ¦‚å¿µ - 2025é«˜ä¸€(3)ç­ | å·²ä¿å­˜ | ä¿å­˜ | å‘å¸ƒ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸ åŸºäºæ¨¡æ¿ï¼š"é›†åˆçš„æ¦‚å¿µ v1.2.0"                         â”‚
â”‚    [æŸ¥çœ‹åŸæ¨¡æ¿] [å¯¹æ¯”å·®å¼‚] [åŒæ­¥æ¨¡æ¿æ›´æ–°]       [Ã—å…³é—­] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ› ï¸  â”‚                                                    â”‚
â”‚  å·¥å…· â”‚   [æ–‡æœ¬å•å…ƒ] è¯¾ç¨‹å¯¼å…¥                     [âœ] [Ã—] â”‚
â”‚  æ    â”‚   è¿™æ˜¯ä»æ¨¡æ¿å¤åˆ¶çš„å†…å®¹...                         â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”‚   [â• åœ¨æ­¤æ·»åŠ å•å…ƒ]                               â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”‚   [ä»£ç å•å…ƒ] Python é›†åˆæ“ä½œ               [âœ] [Ã—] â”‚
â”‚       â”‚   # æˆ‘çš„ä¸ªæ€§åŒ–ä¿®æ”¹                                â”‚
â”‚       â”‚   students = {"å¼ ä¸‰", "æå››", ...}   ğŸ”µ å·²ä¿®æ”¹    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 4.1 æ¨¡æ¿æµè§ˆä¸é€‰æ‹©

#### åŠŸèƒ½è¦æ±‚
- âœ… åœ¨è¯¾ç¨‹ç»“æ„ä¸­æ˜¾ç¤ºèµ„æºçš„æ•™æ¡ˆæ¨¡æ¿æ•°é‡
- âœ… ç‚¹å‡»æŸ¥çœ‹æ¨¡æ¿åˆ—è¡¨å’Œè¯¦æƒ…
- âœ… é¢„è§ˆæ¨¡æ¿å†…å®¹ï¼ˆåªè¯»æ¨¡å¼ï¼‰
- âœ… æ˜¾ç¤ºæ¨¡æ¿è¯„åˆ†å’Œä½¿ç”¨ç»Ÿè®¡
- âœ… æ”¯æŒæŒ‰éš¾åº¦ã€è¯„åˆ†ã€æ—¶é•¿ç­›é€‰

#### API è®¾è®¡
```typescript
// è·å–èµ„æºçš„æ•™æ¡ˆæ¨¡æ¿åˆ—è¡¨
GET /api/v1/resources/{resource_id}/templates
Response: {
  templates: [
    {
      id: 1,
      title: "é›†åˆçš„æ¦‚å¿µ",
      description: "åŸºç¡€æ•™æ¡ˆï¼Œé€‚åˆæ–°è¯¾å¯¼å…¥",
      version: "1.2.0",
      difficulty: "basic",
      estimated_duration: 45,
      cell_count: 5,
      usage_count: 126,
      rating: 4.8,
      is_official: true,
      created_by: {...},
      preview_image_url: "...",
    }
  ]
}

// è·å–æ¨¡æ¿è¯¦æƒ…
GET /api/v1/templates/{template_id}
Response: {
  ...åŸºæœ¬ä¿¡æ¯,
  content: [...cells],
  reviews: [...æ•™å¸ˆè¯„ä»·],
  statistics: {...ä½¿ç”¨ç»Ÿè®¡}
}
```

### 4.2 åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆ

#### åŠŸèƒ½è¦æ±‚
- âœ… å¤åˆ¶æ¨¡æ¿çš„æ‰€æœ‰ Cell åˆ°æ–°æ•™æ¡ˆ
- âœ… è®°å½•æ¨¡æ¿å¼•ç”¨å…³ç³»ï¼ˆtemplate_id, template_versionï¼‰
- âœ… å…è®¸æ•™å¸ˆä¿®æ”¹æ ‡é¢˜ã€æè¿°ã€æ ‡ç­¾
- âœ… è‡ªåŠ¨å…³è”åˆ°å¯¹åº”çš„è¯¾ç¨‹

#### API è®¾è®¡
```typescript
// åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆ
POST /api/v1/lessons/from-template
Request: {
  template_id: 1,
  course_id: 10,
  title: "é›†åˆçš„æ¦‚å¿µ - 2025é«˜ä¸€(3)ç­",
  description: "...",
  tags: ["é›†åˆ", "Python", "é«˜ä¸€3ç­"]
}
Response: {
  lesson: {
    id: 123,
    template_id: 1,
    template_version: "1.2.0",
    is_modified: false,
    content: [...ä»æ¨¡æ¿å¤åˆ¶çš„cells],
    ...
  }
}
```

#### å®ç°é€»è¾‘
```python
async def create_lesson_from_template(
    template_id: int,
    course_id: int,
    teacher_id: int,
    customization: LessonCustomization
):
    # 1. è·å–æ¨¡æ¿
    template = await get_template(template_id)
    
    # 2. æ·±æ‹·è´æ¨¡æ¿å†…å®¹
    content = deep_copy_cells(template.content)
    
    # 3. åˆ›å»ºæ•™æ¡ˆ
    lesson = Lesson(
        course_id=course_id,
        teacher_id=teacher_id,
        title=customization.title or template.title,
        description=customization.description or template.description,
        content=content,
        tags=customization.tags or template.tags,
        template_id=template.id,
        template_version=template.version,
        is_modified=False,
        status="draft"
    )
    
    # 4. ä¿å­˜
    await db.save(lesson)
    
    # 5. æ›´æ–°æ¨¡æ¿ä½¿ç”¨ç»Ÿè®¡
    await increment_template_usage(template_id)
    
    return lesson
```

### 4.3 ä¿®æ”¹è·Ÿè¸ª

#### åŠŸèƒ½è¦æ±‚
- âœ… è‡ªåŠ¨æ£€æµ‹æ•™å¸ˆå¯¹æ¨¡æ¿å†…å®¹çš„ä¿®æ”¹
- âœ… æ ‡è®°å·²ä¿®æ”¹çš„ Cell
- âœ… ç”Ÿæˆä¿®æ”¹æ‘˜è¦
- âœ… æ”¯æŒæŸ¥çœ‹ä¸åŸæ¨¡æ¿çš„å·®å¼‚

#### ä¿®æ”¹æ£€æµ‹é€»è¾‘
```typescript
// Cell å±‚é¢çš„ä¿®æ”¹æ£€æµ‹
interface CellWithMetadata extends Cell {
  _metadata?: {
    fromTemplate: boolean
    originalCellId?: string
    isModified: boolean
    modificationDate?: Date
  }
}

// è‡ªåŠ¨æ ‡è®°ä¿®æ”¹
function detectModifications(lesson: Lesson, template: LessonTemplate) {
  const modifications = {
    added: [],
    removed: [],
    modified: [],
    reordered: false
  }
  
  // æ£€æµ‹æ·»åŠ /åˆ é™¤
  const templateCellIds = template.content.map(c => c.id)
  const lessonCellIds = lesson.content.map(c => c._metadata?.originalCellId)
  
  modifications.added = lesson.content.filter(
    c => !c._metadata?.fromTemplate
  )
  
  modifications.removed = templateCellIds.filter(
    id => !lessonCellIds.includes(id)
  )
  
  // æ£€æµ‹å†…å®¹ä¿®æ”¹
  lesson.content.forEach(cell => {
    if (cell._metadata?.fromTemplate) {
      const originalCell = findCell(template.content, cell._metadata.originalCellId)
      if (!deepEqual(cell.content, originalCell.content)) {
        modifications.modified.push(cell.id)
        cell._metadata.isModified = true
      }
    }
  })
  
  // æ£€æµ‹é¡ºåºå˜åŒ–
  modifications.reordered = checkOrderChanged(lesson, template)
  
  return modifications
}
```

### 4.4 å·®å¼‚å¯¹æ¯”

#### åŠŸèƒ½è¦æ±‚
- âœ… å¹¶æ’æ˜¾ç¤ºåŸæ¨¡æ¿å’Œå½“å‰æ•™æ¡ˆ
- âœ… é«˜äº®æ˜¾ç¤ºå·®å¼‚éƒ¨åˆ†
- âœ… æ”¯æŒé€é¡¹å¯¹æ¯”
- âœ… æ˜¾ç¤ºä¿®æ”¹ç»Ÿè®¡

#### UI è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸æ¨¡æ¿å¯¹æ¯”                                      [Ã—]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  ğŸ“Š ä¿®æ”¹æ‘˜è¦                                             â”‚
â”‚     âœ“ æ–°å¢ 2 ä¸ªå•å…ƒ                                      â”‚
â”‚     âœ“ ä¿®æ”¹ 3 ä¸ªå•å…ƒ                                      â”‚
â”‚     âœ“ åˆ é™¤ 1 ä¸ªå•å…ƒ                                      â”‚
â”‚     âœ“ è°ƒæ•´äº†é¡ºåº                                         â”‚
â”‚                                                           â”‚
â”‚  ğŸ“‹ è¯¦ç»†å¯¹æ¯”                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  åŸæ¨¡æ¿ (v1.2.0)   â”‚  æˆ‘çš„æ•™æ¡ˆ          â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ [æ–‡æœ¬] è¯¾ç¨‹å¯¼å…¥    â”‚ [æ–‡æœ¬] è¯¾ç¨‹å¯¼å…¥    â”‚ æ— å˜åŒ–     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ [æ–‡æœ¬] é›†åˆå®šä¹‰    â”‚ [æ–‡æœ¬] é›†åˆå®šä¹‰    â”‚ ğŸ”µ å·²ä¿®æ”¹  â”‚
â”‚  â”‚ é›†åˆæ˜¯...          â”‚ é›†åˆæ˜¯...          â”‚            â”‚
â”‚  â”‚                    â”‚ + å¢åŠ äº†æœ¬åœ°åŒ–æ¡ˆä¾‹ â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ [ä»£ç ] Pythonæ¼”ç¤º  â”‚ [ä»£ç ] Pythonæ¼”ç¤º  â”‚ ğŸ”µ å·²ä¿®æ”¹  â”‚
â”‚  â”‚ set1 = {1,2,3}     â”‚ students = {...}   â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚                    â”‚ [é—®ç­”] è¯¾å ‚å°æµ‹    â”‚ â• æ–°å¢    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ [ä»¿çœŸ] ç»´æ©å›¾      â”‚                    â”‚ â– å·²åˆ é™¤  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              [è¿˜åŸä¸ºæ¨¡æ¿]  [ä¿ç•™ä¿®æ”¹]  [å…³é—­]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 æ¨¡æ¿æ›´æ–°åŒæ­¥

#### åŠŸèƒ½è¦æ±‚
- âœ… æ£€æµ‹æ¨¡æ¿æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
- âœ… æç¤ºæ•™å¸ˆåŒæ­¥æ›´æ–°
- âœ… æ™ºèƒ½åˆå¹¶ï¼ˆä¿ç•™æ•™å¸ˆçš„ä¸ªæ€§åŒ–ä¿®æ”¹ï¼‰
- âœ… å†²çªè§£å†³æœºåˆ¶

#### æ›´æ–°æ£€æµ‹
```typescript
// æ£€æŸ¥æ¨¡æ¿æ›´æ–°
async function checkTemplateUpdate(lesson: Lesson) {
  if (!lesson.template_id) return null
  
  const currentTemplate = await fetchTemplate(lesson.template_id)
  
  if (currentTemplate.version > lesson.template_version) {
    return {
      hasUpdate: true,
      currentVersion: lesson.template_version,
      latestVersion: currentTemplate.version,
      changeLog: currentTemplate.changeLog
    }
  }
  
  return null
}
```

#### æ™ºèƒ½åˆå¹¶ç­–ç•¥
```typescript
async function syncTemplateUpdate(
  lesson: Lesson,
  template: LessonTemplate,
  strategy: 'auto' | 'manual'
) {
  if (strategy === 'auto') {
    // è‡ªåŠ¨åˆå¹¶ï¼šä¿ç•™æ•™å¸ˆä¿®æ”¹ï¼Œæ·»åŠ æ¨¡æ¿æ–°å¢å†…å®¹
    const mergedContent = []
    
    // 1. ä¿ç•™æ•™å¸ˆæ–°å¢çš„ Cell
    const teacherAddedCells = lesson.content.filter(
      c => !c._metadata?.fromTemplate
    )
    
    // 2. æ›´æ–°æ¥è‡ªæ¨¡æ¿ä¸”æœªä¿®æ”¹çš„ Cell
    lesson.content.forEach(cell => {
      if (cell._metadata?.fromTemplate && !cell._metadata?.isModified) {
        const updatedCell = findCellInTemplate(template, cell._metadata.originalCellId)
        if (updatedCell) {
          mergedContent.push(updatedCell)
        }
      } else {
        mergedContent.push(cell)
      }
    })
    
    // 3. æ·»åŠ æ¨¡æ¿æ–°å¢çš„ Cell
    const newCells = template.content.filter(
      c => !findCellInLesson(lesson, c.id)
    )
    mergedContent.push(...newCells)
    
    return mergedContent
  } else {
    // æ‰‹åŠ¨åˆå¹¶ï¼šæ˜¾ç¤ºå†²çªè§£å†³ç•Œé¢
    return showMergeConflictDialog(lesson, template)
  }
}
```

---

## äº”ã€æŠ€æœ¯å®ç°

### 5.1 å‰ç«¯ç»„ä»¶ç»“æ„

```typescript
// æ–°å¢/ä¿®æ”¹çš„ç»„ä»¶

// 1. æ•™æ¡ˆæ¨¡æ¿åˆ—è¡¨ç»„ä»¶
<LessonTemplateList
  :resource-id="resourceId"
  @select="handleTemplateSelect"
/>

// 2. æ¨¡æ¿è¯¦æƒ…å¯¹è¯æ¡†
<TemplateDetailModal
  :template-id="templateId"
  @create-lesson="handleCreateFromTemplate"
  @preview="handlePreview"
/>

// 3. åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆå¯¹è¯æ¡†ï¼ˆå¢å¼ºç‰ˆCreateLessonModalï¼‰
<CreateLessonModal
  :course-id="courseId"
  :template-id="templateId"  // å¯é€‰
  @create="handleCreate"
/>

// 4. æ¨¡æ¿å·®å¼‚å¯¹æ¯”ç»„ä»¶
<TemplateDiffViewer
  :lesson="currentLesson"
  :template-id="templateId"
  @restore="handleRestore"
/>

// 5. æ¨¡æ¿æ›´æ–°æç¤ºç»„ä»¶
<TemplateUpdateAlert
  :lesson="currentLesson"
  @sync="handleSync"
  @dismiss="handleDismiss"
/>
```

### 5.2 å‰ç«¯æœåŠ¡å±‚

```typescript
// frontend/src/services/template.ts

export const templateService = {
  // è·å–èµ„æºçš„æ¨¡æ¿åˆ—è¡¨
  async getTemplatesByResource(resourceId: number) {
    const response = await api.get(`/resources/${resourceId}/templates`)
    return response.data
  },
  
  // è·å–æ¨¡æ¿è¯¦æƒ…
  async getTemplate(templateId: number) {
    const response = await api.get(`/templates/${templateId}`)
    return response.data
  },
  
  // åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆ
  async createLessonFromTemplate(data: CreateFromTemplateRequest) {
    const response = await api.post('/lessons/from-template', data)
    return response.data
  },
  
  // æ£€æŸ¥æ¨¡æ¿æ›´æ–°
  async checkTemplateUpdate(lessonId: number) {
    const response = await api.get(`/lessons/${lessonId}/check-template-update`)
    return response.data
  },
  
  // åŒæ­¥æ¨¡æ¿æ›´æ–°
  async syncTemplateUpdate(lessonId: number, strategy: 'auto' | 'manual') {
    const response = await api.post(`/lessons/${lessonId}/sync-template`, { strategy })
    return response.data
  },
  
  // å¯¹æ¯”å·®å¼‚
  async compareLessonWithTemplate(lessonId: number) {
    const response = await api.get(`/lessons/${lessonId}/compare-template`)
    return response.data
  }
}
```

### 5.3 åç«¯ API è·¯ç”±

```python
# backend/app/api/v1/templates.py

from fastapi import APIRouter, Depends, HTTPException
from typing import List

router = APIRouter()

@router.get("/resources/{resource_id}/templates")
async def get_resource_templates(
    resource_id: int,
    difficulty: Optional[str] = None,
    sort_by: str = "rating",
    current_user: User = Depends(get_current_user)
) -> List[LessonTemplateResponse]:
    """è·å–èµ„æºçš„æ•™æ¡ˆæ¨¡æ¿åˆ—è¡¨"""
    templates = await template_service.get_by_resource(
        resource_id,
        difficulty=difficulty,
        sort_by=sort_by
    )
    return templates

@router.get("/templates/{template_id}")
async def get_template(
    template_id: int,
    current_user: User = Depends(get_current_user)
) -> LessonTemplateDetail:
    """è·å–æ¨¡æ¿è¯¦æƒ…"""
    template = await template_service.get_by_id(template_id)
    if not template:
        raise HTTPException(404, "Template not found")
    return template

@router.post("/lessons/from-template")
async def create_lesson_from_template(
    data: CreateFromTemplateRequest,
    current_user: User = Depends(get_current_teacher)
) -> LessonResponse:
    """åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆ"""
    lesson = await lesson_service.create_from_template(
        template_id=data.template_id,
        course_id=data.course_id,
        teacher_id=current_user.id,
        customization=data
    )
    return lesson

@router.get("/lessons/{lesson_id}/check-template-update")
async def check_template_update(
    lesson_id: int,
    current_user: User = Depends(get_current_teacher)
) -> TemplateUpdateInfo:
    """æ£€æŸ¥æ¨¡æ¿æ˜¯å¦æœ‰æ›´æ–°"""
    lesson = await lesson_service.get_by_id(lesson_id)
    if lesson.teacher_id != current_user.id:
        raise HTTPException(403, "Not authorized")
    
    update_info = await template_service.check_update(lesson)
    return update_info

@router.post("/lessons/{lesson_id}/sync-template")
async def sync_template_update(
    lesson_id: int,
    strategy: SyncStrategy,
    current_user: User = Depends(get_current_teacher)
) -> LessonResponse:
    """åŒæ­¥æ¨¡æ¿æ›´æ–°"""
    lesson = await lesson_service.sync_template(
        lesson_id,
        strategy=strategy.strategy
    )
    return lesson

@router.get("/lessons/{lesson_id}/compare-template")
async def compare_with_template(
    lesson_id: int,
    current_user: User = Depends(get_current_teacher)
) -> DiffResult:
    """å¯¹æ¯”æ•™æ¡ˆä¸æ¨¡æ¿çš„å·®å¼‚"""
    lesson = await lesson_service.get_by_id(lesson_id)
    if not lesson.template_id:
        raise HTTPException(400, "Lesson not based on template")
    
    diff = await template_service.compare(lesson)
    return diff
```

### 5.4 æ•°æ®åº“è¿ç§»

```python
# backend/alembic/versions/002_add_lesson_templates.py

def upgrade():
    # åˆ›å»ºæ¨¡æ¿è¡¨
    op.create_table(
        'lesson_templates',
        sa.Column('id', sa.Integer(), primary_key=True),
        sa.Column('resource_id', sa.Integer(), sa.ForeignKey('resources.id')),
        sa.Column('title', sa.String(200), nullable=False),
        sa.Column('description', sa.Text()),
        sa.Column('content', sa.JSON(), nullable=False),
        sa.Column('version', sa.String(20), nullable=False),
        sa.Column('difficulty', sa.String(20)),
        sa.Column('estimated_duration', sa.Integer()),
        sa.Column('tags', sa.JSON()),
        sa.Column('created_by', sa.Integer(), sa.ForeignKey('users.id')),
        sa.Column('is_official', sa.Boolean(), default=False),
        sa.Column('usage_count', sa.Integer(), default=0),
        sa.Column('rating', sa.Float(), default=0),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
    )
    
    # ä¸º lessons è¡¨æ·»åŠ æ¨¡æ¿å…³è”å­—æ®µ
    op.add_column('lessons', sa.Column('template_id', sa.Integer(), sa.ForeignKey('lesson_templates.id')))
    op.add_column('lessons', sa.Column('template_version', sa.String(20)))
    op.add_column('lessons', sa.Column('is_modified', sa.Boolean(), default=False))
    op.add_column('lessons', sa.Column('modification_summary', sa.Text()))
    
    # åˆ›å»ºä¿®æ”¹æ—¥å¿—è¡¨
    op.create_table(
        'lesson_modification_logs',
        sa.Column('id', sa.Integer(), primary_key=True),
        sa.Column('lesson_id', sa.Integer(), sa.ForeignKey('lessons.id')),
        sa.Column('teacher_id', sa.Integer(), sa.ForeignKey('users.id')),
        sa.Column('modification_type', sa.String(50)),
        sa.Column('cell_id', sa.String(100)),
        sa.Column('changes', sa.JSON()),
        sa.Column('created_at', sa.DateTime(), nullable=False),
    )
```

---

## å…­ã€ç”¨æˆ·æ•…äº‹

### æ•…äº‹1ï¼šæ–°æ•™å¸ˆå¿«é€Ÿåˆ›å»ºæ•™æ¡ˆ

**è§’è‰²ï¼š** æè€å¸ˆï¼ˆæ–°å…¥èŒæ•™å¸ˆï¼‰

**åœºæ™¯ï¼š**
1. æè€å¸ˆç™»å½•ç³»ç»Ÿï¼Œéœ€è¦å‡†å¤‡"é›†åˆçš„æ¦‚å¿µ"è¿™èŠ‚è¯¾
2. åœ¨è¯¾ç¨‹ç»“æ„ä¸­æ‰¾åˆ°"é«˜ä¸€æ•°å­¦ â†’ ç¬¬ä¸€ç«  â†’ 1.1 é›†åˆçš„æ¦‚å¿µ"
3. çœ‹åˆ°æœ‰2ä¸ªå®˜æ–¹æ•™æ¡ˆæ¨¡æ¿å¯ç”¨
4. ç‚¹å‡»æŸ¥çœ‹æ¨¡æ¿è¯¦æƒ…ï¼Œå‘ç°"åŸºç¡€ç‰ˆ"æ¨¡æ¿å¾ˆåˆé€‚
5. ç‚¹å‡»"åŸºäºæ­¤æ¨¡æ¿åˆ›å»ºæˆ‘çš„æ•™æ¡ˆ"
6. ä¿®æ”¹æ ‡é¢˜ä¸º"é›†åˆçš„æ¦‚å¿µ - é«˜ä¸€(1)ç­"
7. ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºæ•™æ¡ˆï¼ŒåŒ…å«äº†æ¨¡æ¿çš„æ‰€æœ‰å†…å®¹
8. æè€å¸ˆæ ¹æ®ç­çº§æƒ…å†µï¼Œä¿®æ”¹äº†å…¶ä¸­çš„ä»£ç ç¤ºä¾‹
9. æ·»åŠ äº†ä¸€ä¸ªé’ˆå¯¹æœ¬ç­å­¦ç”Ÿçš„è¯¾å ‚å°æµ‹
10. ä¿å­˜å¹¶å‘å¸ƒæ•™æ¡ˆ

**ä»·å€¼ï¼š** æè€å¸ˆåœ¨30åˆ†é’Ÿå†…å®Œæˆå¤‡è¯¾ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹èŠ±è´¹2å°æ—¶

### æ•…äº‹2ï¼šç»éªŒæ•™å¸ˆä¸ªæ€§åŒ–æ”¹è¿›

**è§’è‰²ï¼š** ç‹è€å¸ˆï¼ˆèµ„æ·±æ•™å¸ˆï¼‰

**åœºæ™¯ï¼š**
1. ç‹è€å¸ˆçœ‹åˆ°å®˜æ–¹æ¨¡æ¿ä¸é”™ï¼Œä½†æƒ³åŠ å…¥è‡ªå·±çš„æ•™å­¦ç»éªŒ
2. åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆåï¼Œè¿›è¡Œå¤§é‡ä¸ªæ€§åŒ–ä¿®æ”¹ï¼š
   - é‡æ–°ç¼–å†™äº†å¯¼å…¥éƒ¨åˆ†
   - æ·»åŠ äº†3ä¸ªå®æˆ˜æ¡ˆä¾‹
   - åˆ é™¤äº†ä¸€ä¸ªä¸é€‚åˆçš„ä»¿çœŸå•å…ƒ
   - è°ƒæ•´äº†æ•™å­¦é¡ºåº
3. ç³»ç»Ÿè‡ªåŠ¨æ ‡è®°"å·²ä¿®æ”¹"
4. æœŸä¸­åï¼Œå®˜æ–¹æ›´æ–°äº†æ¨¡æ¿åˆ° v1.3.0
5. ç³»ç»Ÿæç¤ºï¼š"æ¨¡æ¿æœ‰æ›´æ–°ï¼Œæ˜¯å¦åŒæ­¥ï¼Ÿ"
6. ç‹è€å¸ˆé€‰æ‹©"æ™ºèƒ½åˆå¹¶"ï¼š
   - ä¿ç•™è‡ªå·±çš„ä¸ªæ€§åŒ–ä¿®æ”¹
   - æ·»åŠ æ¨¡æ¿æ–°å¢çš„ä¼˜è´¨å†…å®¹
7. è§£å†³å°‘é‡å†²çªåï¼Œå®Œæˆæ›´æ–°

**ä»·å€¼ï¼š** æ—¢äº«å—æ¨¡æ¿çš„ä¾¿åˆ©ï¼Œåˆä¿æŒä¸ªæ€§åŒ–ï¼Œè¿˜èƒ½æŒç»­æ”¹è¿›

### æ•…äº‹3ï¼šæ•™ç ”ç»„åä½œ

**è§’è‰²ï¼š** æ•°å­¦æ•™ç ”ç»„

**åœºæ™¯ï¼š**
1. æ•™ç ”ç»„é•¿åˆ›å»ºäº†ä¸€ä¸ªç²¾å“æ•™æ¡ˆä½œä¸ºæ¨¡æ¿
2. å°†æ•™æ¡ˆæäº¤ä¸º"æ•™ç ”ç»„æ¨¡æ¿"
3. ç»„å†…5ä½è€å¸ˆéƒ½åŸºäºæ­¤æ¨¡æ¿åˆ›å»ºè‡ªå·±çš„æ•™æ¡ˆ
4. æ¯ä½è€å¸ˆæ ¹æ®ä¸åŒç­çº§ç‰¹ç‚¹è¿›è¡Œè°ƒæ•´
5. æœŸæœ«æ€»ç»“æ—¶ï¼Œå¯¹æ¯”å„ç‰ˆæœ¬çš„å·®å¼‚
6. æç‚¼æœ€ä½³å®è·µï¼Œæ›´æ–°æ¨¡æ¿åˆ° v2.0
7. æ‰€æœ‰è€å¸ˆæ”¶åˆ°æ›´æ–°æç¤ºï¼Œé€‰æ‹©æ€§åŒæ­¥

**ä»·å€¼ï¼š** ä¿ƒè¿›æ•™ç ”åä½œï¼ŒçŸ¥è¯†å…±äº«ï¼ŒæŒç»­æ”¹è¿›

---

## ä¸ƒã€å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆMVPï¼‰
**ç›®æ ‡ï¼š** å®ç°åŸºæœ¬çš„æ¨¡æ¿åˆ›å»ºå’Œä½¿ç”¨

- [ ] æ•°æ®åº“æ¨¡å‹å’Œè¿ç§»
- [ ] æ¨¡æ¿ CRUD API
- [ ] åŸºäºæ¨¡æ¿åˆ›å»ºæ•™æ¡ˆ
- [ ] æ¨¡æ¿åˆ—è¡¨å’Œè¯¦æƒ…å±•ç¤º
- [ ] ä¿®æ”¹ CreateLessonModal æ”¯æŒæ¨¡æ¿é€‰æ‹©

**æ—¶é—´ï¼š** 1å‘¨

### é˜¶æ®µ2ï¼šä¿®æ”¹è·Ÿè¸ª
**ç›®æ ‡ï¼š** è·Ÿè¸ªæ•™å¸ˆçš„ä¸ªæ€§åŒ–ä¿®æ”¹

- [ ] Cell å…ƒæ•°æ®ç³»ç»Ÿ
- [ ] ä¿®æ”¹æ£€æµ‹é€»è¾‘
- [ ] ä¿®æ”¹æ ‡è®°UI
- [ ] ä¿®æ”¹æ—¥å¿—è®°å½•

**æ—¶é—´ï¼š** 1å‘¨

### é˜¶æ®µ3ï¼šå·®å¼‚å¯¹æ¯”
**ç›®æ ‡ï¼š** å¯è§†åŒ–å¯¹æ¯”æ•™æ¡ˆä¸æ¨¡æ¿

- [ ] å·®å¼‚å¯¹æ¯”ç®—æ³•
- [ ] å¹¶æ’å¯¹æ¯”UI
- [ ] ä¿®æ”¹æ‘˜è¦ç”Ÿæˆ
- [ ] è¿˜åŸåŠŸèƒ½

**æ—¶é—´ï¼š** 1å‘¨

### é˜¶æ®µ4ï¼šæ›´æ–°åŒæ­¥
**ç›®æ ‡ï¼š** æ™ºèƒ½åŒæ­¥æ¨¡æ¿æ›´æ–°

- [ ] ç‰ˆæœ¬æ£€æµ‹æœºåˆ¶
- [ ] æ›´æ–°æç¤ºUI
- [ ] æ™ºèƒ½åˆå¹¶ç®—æ³•
- [ ] å†²çªè§£å†³ç•Œé¢

**æ—¶é—´ï¼š** 1.5å‘¨

### é˜¶æ®µ5ï¼šä¼˜åŒ–å’Œå¢å¼º
**ç›®æ ‡ï¼š** ç”¨æˆ·ä½“éªŒä¼˜åŒ–

- [ ] æ¨¡æ¿è¯„åˆ†å’Œè¯„è®º
- [ ] æ¨¡æ¿æœç´¢å’Œç­›é€‰
- [ ] ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ
- [ ] æ€§èƒ½ä¼˜åŒ–

**æ—¶é—´ï¼š** 1å‘¨

**æ€»è®¡ï¼š** 5.5å‘¨

---

## å…«ã€æ€»ç»“

### æ ¸å¿ƒä»·å€¼
1. **æé«˜æ•ˆç‡ï¼š** æ•™å¸ˆä¸éœ€è¦ä»é›¶å¼€å§‹ï¼ŒåŸºäºä¼˜è´¨æ¨¡æ¿å¿«é€Ÿåˆ›å»º
2. **ä¿è¯è´¨é‡ï¼š** æ ‡å‡†æ¨¡æ¿ç¡®ä¿æ•™å­¦å†…å®¹çš„å®Œæ•´æ€§å’Œè§„èŒƒæ€§
3. **é¼“åŠ±åˆ›æ–°ï¼š** æ•™å¸ˆå¯ä»¥è‡ªç”±ä¿®æ”¹ï¼Œæ·»åŠ ä¸ªæ€§åŒ–å†…å®¹
4. **æŒç»­æ”¹è¿›ï¼š** æ¨¡æ¿å¯ä»¥è¿­ä»£æ›´æ–°ï¼Œæ•™å¸ˆå¯ä»¥åŒæ­¥æœ€æ–°ç‰ˆæœ¬
5. **ä¿ƒè¿›åä½œï¼š** ä¼˜ç§€æ•™æ¡ˆå¯ä»¥æ²‰æ·€ä¸ºæ¨¡æ¿ï¼Œå®ç°çŸ¥è¯†å…±äº«

### è®¾è®¡åŸåˆ™
- **çµæ´»æ€§ï¼š** æ”¯æŒä»æ¨¡æ¿åˆ›å»ºï¼Œä¹Ÿæ”¯æŒä»ç©ºç™½åˆ›å»º
- **å¯è¿½æº¯ï¼š** è®°å½•æ¨¡æ¿æ¥æºå’Œä¿®æ”¹å†å²
- **éä¾µå…¥ï¼š** ä¸å½±å“ç°æœ‰çš„æ•™æ¡ˆåˆ›å»ºæµç¨‹
- **ç”¨æˆ·å‹å¥½ï¼š** ç®€åŒ–æ“ä½œæµç¨‹ï¼Œæ™ºèƒ½åŒ–åˆå¹¶

### ä¸‹ä¸€æ­¥
1. ä¸æ•™å¸ˆç”¨æˆ·è®¿è°ˆï¼ŒéªŒè¯éœ€æ±‚
2. è®¾è®¡è¯¦ç»†çš„UIåŸå‹
3. å®æ–½é˜¶æ®µ1ï¼Œè·å–æ—©æœŸåé¦ˆ
4. è¿­ä»£ä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-10-17

